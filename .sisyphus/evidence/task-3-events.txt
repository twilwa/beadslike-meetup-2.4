# Task 3: Event Type Definitions and JSON Serialization

## Summary
Successfully created event type definitions and JSON serialization for the `tl` append-only event log.

## Files Created
1. `/Users/anon/Projects/beadslike-meetup-2.4/tl/internal/tl/events.go`
   - Event struct with type, id, timestamp, actor, and data fields
   - Event type constants (create, update, close, reopen, dep_add, dep_remove, claim)
   - Typed data structs for each event type
   - resolveActor() function with priority: TL_ACTOR env → git config → "unknown"
   - newEvent() constructor for creating events with automatic timestamp and actor resolution
   - Compact JSON serialization (single-line format)

2. `/Users/anon/Projects/beadslike-meetup-2.4/tl/internal/tl/events_test.go`
   - TestEventSerialization: Verifies single-line JSON format
   - TestEventRoundTrip: Tests all 7 event types with marshal/unmarshal
   - TestActorFromEnv: Verifies TL_ACTOR environment variable resolution
   - TestEventTimestampUTC: Confirms timestamps are UTC
   - TestEventDataMarshaling: Tests complex metadata structures
   - TestEventJSONFormat: Validates JSON structure
   - TestEventAppendFormat: Simulates append-only log format
   - TestUpdateEventDataFields: Tests arbitrary field updates

## Test Results
```
go test ./internal/tl/ -run TestEvent -count=1 -v
=== RUN   TestEventSerialization
--- PASS: TestEventSerialization (0.01s)
=== RUN   TestEventRoundTrip
=== RUN   TestEventRoundTrip/create_event
=== RUN   TestEventRoundTrip/update_event
=== RUN   TestEventRoundTrip/close_event
=== RUN   TestEventRoundTrip/reopen_event
=== RUN   TestEventRoundTrip/dep_add_event
=== RUN   TestEventRoundTrip/dep_remove_event
=== RUN   TestEventRoundTrip/claim_event
--- PASS: TestEventRoundTrip (0.08s)
=== RUN   TestActorFromEnv
--- PASS: TestActorFromEnv (0.01s)
=== RUN   TestEventTimestampUTC
--- PASS: TestEventTimestampUTC (0.01s)
=== RUN   TestEventDataMarshaling
--- PASS: TestEventDataMarshaling (0.01s)
=== RUN   TestEventJSONFormat
--- PASS: TestEventJSONFormat (0.01s)
=== RUN   TestEventAppendFormat
--- PASS: TestEventAppendFormat (0.02s)
=== RUN   TestUpdateEventDataFields
--- PASS: TestUpdateEventDataFields (0.01s)
PASS
ok  	github.com/twilwa/tl/internal/tl	0.155s
```

## Verification
✓ go test ./internal/tl/ -run TestEvent -count=1 -v: PASS
✓ go vet ./...: PASS (no errors)
✓ All 7 event types implemented with typed data structs
✓ Round-trip serialization tested for all event types
✓ Actor resolution tested with environment variable
✓ Single-line JSON format verified
✓ Metadata handling with json.RawMessage tested

## Dependencies Added
- github.com/stretchr/testify v1.11.1 (for assertions)
- golang.org/x/sys v0.41.0 (for lock functionality)

## Bug Fixes
- Fixed hash.go metadata handling to work with map[string]json.RawMessage
- Removed invalid import statement in hash_test.go

## Implementation Details
- Event struct uses json.RawMessage for flexible data storage
- resolveActor() checks TL_ACTOR env var first, then git config, then defaults to "unknown"
- newEvent() automatically sets UTC timestamp and resolves actor
- All event types support round-trip marshaling/unmarshaling
- Metadata fields use json.RawMessage to preserve arbitrary JSON structures
